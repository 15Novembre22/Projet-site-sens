{% load static %} 
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'welcome.css' %}">
    <title>Ciras Cybersens</title>
</head>
<body>
    <header>
        <nav>
            <a href="#accueil"> <img src="/static/logo.jpg" alt="" class="logo"> </a>
            <ul id="nav-list">
                <li> <a href="#accueil" class="active">Accueil</a> </li>
                <li> <a href="#assistance">Assistance</a> </li>
                <li> <a href="#signaler">Signaler</a> </li>
                <li> <a href="#s'informer">S'informer</a> </li>
                <li> <a href="#">Apropos</a> </li>
            </ul>
            
            <div class="menu-burger" id="burger-menu">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </nav>
    </header>
    <main>
    <section id="accueil" class="text">

          <h1>Bienvenue  <span class="auto-typing"></span></h1>

            <p>Renforcez votre vigilance numérique!
             <br> <b> Le CIRAS</b> vous accompagne pour comprendre les cybermenaces </br>
              et adopter les bons réflexes.
              <br> <b> Ensemble, sécurisons notre environnement digital.</b> 
            </p> 
            <div class="buttons">
               <button class="btn-incident"> <a href="#signaler">Signaler un incident</a> </button>
               <button class="cta-button"> <a href="#s'informer">Cyber hygiène</a> </button>
            </div>
          
    </section>
            <div class="overlay">

            </div>
            <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12"></script>
            <script>
                let typed = new Typed('.auto-typing', {
                    strings: ['dans', "l'ère" ,'de la', 'vigilance','digitale'],
                    typeSpeed: 150,
                    backSpeed: 150,
                    loop: true,
                    fadeOut:true,
                    fadeOutClass:'typed-fade-out',
                    fadeOutDelay:500,
                    showCursor: true
                });


        const burger = document.getElementById('burger-menu');
        const navList = document.getElementById('nav-list');

        burger.addEventListener('click', () => {
            burger.classList.toggle('active');
            navList.classList.toggle('active');
        });

        // Fermer le menu au clic sur un lien
        document.querySelectorAll('#nav-list a').forEach(link => {
            link.addEventListener('click', () => {
                burger.classList.remove('active');
                navList.classList.remove('active');
            });
        });


    document.getElementById('incidentForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const form = this;
    const btn = document.getElementById('submitBtn');
    const feedback = document.getElementById('feedback');
    const formData = new FormData(form);

    // État de chargement
    btn.disabled = true;
    btn.innerText = "Envoi en cours...";
    feedback.style.display = 'none';

    try {
        const response = await fetch("{% url 'incident' %}", {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            }
        });

        const data = await response.json();

        if (response.ok) {
            // Succès
            form.reset();
            feedback.style.display = 'block';
            feedback.style.backgroundColor = '#d4edda';
            feedback.style.color = '#155724';
            feedback.innerHTML = "<strong>Succès !</strong> Votre signalement a été transmis. Un conseiller vous contactera prochainement.";
            btn.innerText = "ENVOYER LE SIGNALEMENT";
            btn.disabled = false;
        } else {
            // Erreur serveur ou validation
            throw new Error(data.message || "Une erreur est survenue.");
        }
    } catch (error) {
        feedback.style.display = 'block';
        feedback.style.backgroundColor = '#f8d7da';
        feedback.style.color = '#721c24';
        feedback.innerText = error.message;
        btn.disabled = false;
        btn.innerText = "RÉESSAYER";
    }
});
        </script>

        <section id="s'informer" class="content-section">
            <div class="section-header">
                <h2>S'informer</h2>
                <p>Apprenez à déjouer les pièges des pirates</p>
            </div>
    <div class="grid-container">
        {% for conseil in all_conseils %}
        <article class="card" onclick="location.href='#'">
            {% if conseil.image %}
                <img src="{{ conseil.image.url }}" alt="{{ conseil.titre }}">
            {% endif %}
            
            <div class="card-content">
                <span class="badge {{ conseil.categorie }}">
                    {{ conseil.get_categorie_display }}
                </span>
                
                <h3>{{ conseil.titre }}</h3>
                <p>{{ conseil.description|truncatechars:150 }}</p>
                <div class="card-footer">
                <span class="btn-read-more">En savoir plus <i class="arrow-icon">→</i></span>
            </div>
            </div>
            
        </article>
        {% empty %}
            <p>Aucun conseil disponible pour le moment.</p>
        {% endfor %}
    </div> </section>

        <section id="assistance" class="content-section">
                <h2>Besoin d'aide ?</h2>
        <p>Contacter un assistant...</p>
        </section>

    <section id="signaler" class="spa-section">
    <div class="incident-container">
    <h2 class="form-title">Signaler un incident au CIRAS</h2>
    <p class="subtitle">Toutes les informations transmises sont sécurisées et confidentielles.</p>
    
    <form method="post" enctype="multipart/form-data" class="custom-form">
        {% csrf_token %}
        <div class="form-grid">
            {{ incident_form.as_p }}
        </div>
        <button type="submit" class="btn-submit">Envoyer le signalement</button>
    </form>
</div>

        </section>



        </main>
</body>
</html>